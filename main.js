/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var B=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var _=Object.prototype.hasOwnProperty;var $=(u,h)=>{for(var e in h)B(u,e,{get:h[e],enumerable:!0})},W=(u,h,e,t)=>{if(h&&typeof h=="object"||typeof h=="function")for(let n of O(h))!_.call(u,n)&&n!==e&&B(u,n,{get:()=>h[n],enumerable:!(t=A(h,n))||t.enumerable});return u};var X=u=>W(B({},"__esModule",{value:!0}),u);var Z={};$(Z,{default:()=>S});module.exports=X(Z);var R=require("obsidian");var f=require("obsidian"),F="library-3d-view",D=class extends f.ItemView{constructor(e,t){super(e);this.plugin=t}getViewType(){return F}getDisplayText(){return"Library 2D"}getIcon(){return"library"}async onOpen(){await this.renderRoom(),this.registerEvent(this.app.metadataCache.on("changed",()=>{this.renderRoom()}))}async renderRoom(){let e=this.containerEl.children[1];e.empty(),e.addClass("library-image-room-wrapper");let t=e.createDiv({cls:"room-dashboard"}),g=t.createDiv({cls:"room-tools"}).createEl("button",{text:"\u2728 V\u1EBD v\xF9ng ch\u1ECDn m\u1EDBi"}),p=this.app.vault.configDir+"/plugins/loom-view",r=this.app.vault.adapter.getResourcePath(p+"/"+(this.plugin.settings.roomImagePath||"room-bg.png")),o=t.createEl("img",{cls:"room-bg-img",attr:{src:r}}),l=!1,d=0,y=0,c=null;g.onclick=()=>{l=!l,g.toggleClass("is-active",l),g.textContent=l?"\u{1F6D1} H\u1EE7y v\u1EBD":"\u2728 V\u1EBD v\xF9ng ch\u1ECDn m\u1EDBi",t.style.cursor=l?"crosshair":"default"},t.onmousedown=s=>{if(!l)return;let i=o.getBoundingClientRect();d=(s.clientX-i.left)/i.width*100,y=(s.clientY-i.top)/i.height*100,c=t.createDiv({cls:"selection-rect"}),c.style.left=d+"%",c.style.top=y+"%"},t.onmousemove=s=>{if(!l||!c)return;let i=o.getBoundingClientRect(),v=(s.clientX-i.left)/i.width*100,w=(s.clientY-i.top)/i.height*100,L=Math.min(d,v),C=Math.min(y,w),k=Math.abs(d-v),x=Math.abs(y-w);c.style.left=L+"%",c.style.top=C+"%",c.style.width=k+"%",c.style.height=x+"%"},t.onmouseup=async s=>{if(!l||!c)return;let i=c.getBoundingClientRect(),v=o.getBoundingClientRect(),w=(i.top-v.top)/v.height*100,L=(i.left-v.left)/v.width*100,C=i.width/v.width*100,k=i.height/v.height*100,x=document.body.createDiv({cls:"hotspot-modal zone-detail-panel"});x.createDiv({cls:"panel-header"}).createEl("h2",{text:"C\xE0i \u0111\u1EB7t v\xF9ng ch\u1ECDn m\u1EDBi"});let b=x.createDiv({cls:"panel-file-list"});b.style.padding="20px",b.createEl("label",{text:"T\xEAn v\xF9ng (v\xED d\u1EE5: T\u1EE7 s\xE1ch)"});let P=b.createEl("input",{attr:{type:"text",placeholder:"T\xEAn..."}});P.style.width="100%",P.style.marginBottom="15px",b.createEl("label",{text:"\u0110\u01B0\u1EDDng d\u1EABn Folder"});let V=b.createEl("input",{attr:{type:"text",placeholder:"Folder..."}});V.style.width="100%",V.style.marginBottom="20px";let E=b.createDiv({cls:"modal-btn-row"});E.style.display="flex",E.style.gap="10px";let H=E.createEl("button",{text:"\u{1F4BE} L\u01B0u v\xF9ng ch\u1ECDn",cls:"mod-cta"}),N=E.createEl("button",{text:"H\u1EE7y"});H.onclick=async()=>{let I=P.value,Y=V.value;I&&(this.plugin.settings.hotspots.push({id:Date.now().toString(),name:I,path:Y||"",top:w.toFixed(1)+"%",left:L.toFixed(1)+"%",width:C.toFixed(1)+"%",height:k.toFixed(1)+"%"}),await this.plugin.saveSettings(),new f.Notice(`\u0110\xE3 th\xEAm v\xF9ng ch\u1ECDn: ${I}`)),x.remove(),this.renderRoom()},N.onclick=()=>{x.remove()},c.remove(),c=null,l=!1,g.textContent="\u2728 V\u1EBD v\xF9ng ch\u1ECDn m\u1EDBi",g.removeClass("is-active"),t.style.cursor="default"};let a=t.createDiv({cls:"room-overlay"});this.plugin.settings.hotspots.forEach(s=>{let i=a.createDiv({cls:"hotspot",attr:{"data-zone":s.id}});i.style.top=s.top,i.style.left=s.left,i.style.width=s.width,i.style.height=s.height;let v=i.createDiv({cls:"hotspot-label",text:s.path||s.name});i.addEventListener("click",w=>{w.stopPropagation(),this.showZoneFiles(s)})})}async showZoneFiles(e,t){let n=t||e.path,g=this.containerEl.children[1],p=this.app.vault.getAbstractFileByPath(n),r=p instanceof f.TFolder?p.children:[],o=g.querySelector(".zone-detail-panel");!t&&o&&(o.remove(),o=null);let l;if(o){l=o;let a=l.querySelector(".panel-header h2");a&&(a.textContent=n.split("/").pop()||e.name)}else{l=g.createDiv({cls:"zone-detail-panel"});let a=l.createDiv({cls:"panel-header"});a.createEl("h2",{text:e.name});let s=a.createEl("button",{text:"\u2715"});s.onclick=()=>l.remove(),l.createDiv({cls:"panel-file-list"})}let d=l.querySelector(".panel-file-list");if(d.empty(),t&&t!==e.path){let a=d.createDiv({cls:"file-item back-item"});a.createSpan({text:"\u2B05\uFE0F QUAY L\u1EA0I"}),a.onclick=()=>{let s=t.split("/");s.pop(),this.showZoneFiles(e,s.join("/"))}}if(r.length===0){d.createDiv({text:"Tr\u1ED1ng r\u1ED7ng...",cls:"empty-msg"});return}let y=r.filter(a=>a instanceof f.TFolder),c=r.filter(a=>a instanceof f.TFile&&(a.extension==="md"||a.extension==="canvas"||a.extension==="base"));y.sort((a,s)=>a.name.localeCompare(s.name)),c.sort((a,s)=>s.stat.ctime-a.stat.ctime),y.forEach(a=>{let s=d.createDiv({cls:"file-item folder-item"});s.createSpan({text:"\u{1F4C1} "}),s.createSpan({text:a.name,cls:"file-name"}),s.onclick=i=>{i.stopPropagation(),this.showZoneFiles(e,a.path)}}),c.forEach(a=>{let s=d.createDiv({cls:"file-item"}),i="\u{1F4C4} ";a.extension==="canvas"&&(i="\u{1F3A8} "),a.extension==="base"&&(i="\u{1F9F1} "),s.createSpan({text:i}),s.createSpan({text:a.basename,cls:"file-name"}),s.onclick=()=>{this.app.workspace.getLeaf("tab").openFile(a)}})}renderBook(e,t,n){var y;let g=this.app.metadataCache.getFileCache(t),p=((y=g==null?void 0:g.frontmatter)==null?void 0:y.status)||"default",r=t.extension==="canvas",o=e.createDiv({cls:`book-item status-${p} ${r?"is-canvas":""}`,attr:{"data-path":t.path}}),l=(Math.random()-.5)*10;o.style.transform=`rotate(${l}deg) translateY(-${n*4}px)`;let d=o.createDiv({cls:"book-title",text:t.basename});o.addEventListener("click",()=>{this.app.workspace.getLeaf(!1).openFile(t)}),o.addEventListener("contextmenu",c=>{let{Menu:a}=window.obsidian,s=new a;s.addItem(i=>i.setTitle("Open in New Tab").onClick(()=>this.app.workspace.getLeaf("tab").openFile(t))),s.showAtMouseEvent(c)})}async onClose(){}};var m=require("obsidian"),M={startDateField:"start-date",endDateField:"end-date",locationField:"region",figuresField:"key-figures",filterField:"",filterValue:"",roomImagePath:"room-bg.png",hotspots:[]},T=class extends m.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"Loom View Settings"}),new m.Setting(e).setName("Start Date Property").setDesc("Frontmatter key for the start date/year (e.g. start-date, year-start)").addText(t=>t.setPlaceholder("start-date").setValue(this.plugin.settings.startDateField).onChange(async n=>{this.plugin.settings.startDateField=n,await this.plugin.saveSettings()})),new m.Setting(e).setName("End Date Property").setDesc("Frontmatter key for the end date/year (e.g. end-date, year-end)").addText(t=>t.setPlaceholder("end-date").setValue(this.plugin.settings.endDateField).onChange(async n=>{this.plugin.settings.endDateField=n,await this.plugin.saveSettings()})),new m.Setting(e).setName("Location/Region Property").setDesc("Frontmatter key for the location or region").addText(t=>t.setPlaceholder("region").setValue(this.plugin.settings.locationField).onChange(async n=>{this.plugin.settings.locationField=n,await this.plugin.saveSettings()})),new m.Setting(e).setName("Figures/People Property").setDesc("Frontmatter key for historical figures or people").addText(t=>t.setPlaceholder("key-figures").setValue(this.plugin.settings.figuresField).onChange(async n=>{this.plugin.settings.figuresField=n,await this.plugin.saveSettings()})),e.createEl("h3",{text:"Filter Settings"}),e.createEl("p",{text:"Optional: Only show notes matching a specific field value (leave empty to show all notes)"}),new m.Setting(e).setName("Filter Field").setDesc('Frontmatter field to filter by (e.g., "type", "tags")').addText(t=>t.setPlaceholder("type").setValue(this.plugin.settings.filterField).onChange(async n=>{this.plugin.settings.filterField=n,await this.plugin.saveSettings()})),new m.Setting(e).setName("Room Image Name").setDesc("T\xEAn file \u1EA3nh trong th\u01B0 m\u1EE5c plugin (b\u1EA5t k\u1EF3 file n\xE0o b\u1EA1n \u0111\xE3 c\xF3p v\xE0o)").addText(t=>t.setValue(this.plugin.settings.roomImagePath).onChange(async n=>{this.plugin.settings.roomImagePath=n,await this.plugin.saveSettings()})),e.createEl("h3",{text:"Custom Hotspots"}),e.createEl("p",{text:"T\u1EF1 \u0111\u1ECBnh ngh\u0129a v\xF9ng ch\u1ECDn. Click chu\u1ED9t v\xE0o \u1EA3nh trong Library View \u0111\u1EC3 l\u1EA5y t\u1ECDa \u0111\u1ED9 (xem Console - Ctrl+Shift+I)."}),this.plugin.settings.hotspots.forEach((t,n)=>{let g=new m.Setting(e).setName(`${t.name}`).addText(r=>r.setPlaceholder("Name").setValue(t.name).onChange(async o=>{t.name=o,await this.plugin.saveSettings()})).addText(r=>r.setPlaceholder("Folder").setValue(t.path).onChange(async o=>{t.path=o,await this.plugin.saveSettings()})).addButton(r=>r.setButtonText("X\xF3a").setWarning().onClick(async()=>{this.plugin.settings.hotspots.splice(n,1),await this.plugin.saveSettings(),this.display()})),p=e.createDiv({cls:"hotspot-coords-edit"});p.style.display="flex",p.style.gap="10px",p.style.padding="5px 20px",["top","left","width","height"].forEach(r=>{let o=p.createEl("input",{attr:{type:"text",value:t[r],placeholder:r}});o.style.width="60px",o.onchange=async l=>{t[r]=l.target.value,await this.plugin.saveSettings()}})}),new m.Setting(e).addButton(t=>t.setButtonText("Th\xEAm v\xF9ng ch\u1ECDn m\u1EDBi").setCta().onClick(async()=>{this.plugin.settings.hotspots.push({id:Date.now().toString(),name:"V\xF9ng m\u1EDBi",path:"",top:"10%",left:"10%",width:"10%",height:"10%"}),await this.plugin.saveSettings(),this.display()}))}};var S=class extends R.Plugin{async onload(){await this.loadSettings(),this.registerView(F,e=>new D(e,this)),this.addRibbonIcon("library","Open Library 2D",()=>{this.activateView(F)}),this.addCommand({id:"open-library-view",name:"Open Library 2D",callback:()=>{this.activateView(F)}}),this.addSettingTab(new T(this.app,this))}async loadSettings(){this.settings=Object.assign({},M,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async activateView(e){let{workspace:t}=this.app,n=t.getLeavesOfType(e)[0];n||(n=t.getLeaf(!0),await n.setViewState({type:e,active:!0})),n&&t.revealLeaf(n)}};
